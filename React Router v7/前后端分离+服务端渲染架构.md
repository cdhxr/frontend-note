
è¿™æ˜¯ä½ æ•´ä¸ªæŠ€æœ¯æ¶æ„é‡Œçš„å…³é”®ç‚¹ä¹‹ä¸€ï¼Œæˆ‘ä»¬æ¥ç³»ç»Ÿæ‹†è§£ï¼š

---

## ğŸ§© é—®é¢˜é‡è¿°

> ä½ ç°åœ¨æ˜¯ä¸€ä¸ª **å‰åç«¯åˆ†ç¦»é¡¹ç›®**ï¼Œå‰ç«¯ç”¨ React + React Router v7ï¼ˆCSRï¼‰ï¼Œåç«¯æ˜¯ Java Spring æä¾› APIã€‚
> 
> ä½ æƒ³å¼•å…¥ **React Router v7 çš„æ¡†æ¶æ¨¡å¼ï¼ˆloader / action / SSRï¼‰**ï¼Œ**ä½†åç«¯æ˜¯ Javaï¼Œä¸æ˜¯ Node**ï¼Œæ€ä¹ˆæ‰èƒ½å®ç° SSRï¼Ÿ

---

## âœ… ç®€æ´å›ç­”ï¼š

> ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ React Router v7 çš„ **æ¡†æ¶æ¨¡å¼ + SSR**ï¼Œä½†ä½ éœ€è¦åœ¨ Java åç«¯å’Œå‰ç«¯ä¹‹é—´å¼•å…¥ä¸€ä¸ª **è½»é‡ Node.js SSR æœåŠ¡ï¼ˆä¸­é—´å±‚ï¼‰**ï¼Œç”¨äºè¿è¡Œ React ä»£ç ã€æ‰§è¡Œ loader/action å¹¶ç”Ÿæˆ HTMLï¼Œç„¶åè°ƒç”¨ Java æä¾›çš„ API è·å–æ•°æ®ã€‚

---

## ğŸ¯ ä¸ºä»€ä¹ˆå¿…é¡»åŠ ä¸€ä¸ª Node SSR ä¸­é—´å±‚ï¼Ÿ

å› ä¸ºï¼š

- React Router çš„ `loader()`ã€`action()`ã€`renderToPipeableStream()` ç­‰ SSR API åªèƒ½åœ¨ Node.js ç¯å¢ƒä¸­è¿è¡Œ
    
- Java æ— æ³•æ‰§è¡Œ React åº”ç”¨ä¸­çš„ loader é€»è¾‘ã€JS è·¯ç”±æ¨¡å—ï¼Œä¹Ÿä¸èƒ½ render React ç»„ä»¶
    
- ä½† React Router çš„ SSR ç‰¹æ€§æœ¬è´¨ä¸Šæ˜¯â€œ**å‰ç«¯+Node SSR + fetch åç«¯ API**â€ï¼ŒJava åç«¯åªæ˜¯ä¸€ä¸ª API æä¾›è€…å³å¯ âœ…
    

---

## ğŸ—ï¸ æ¨èæ¶æ„å›¾

```
    [æµè§ˆå™¨]
        |
        |  è¯·æ±‚ HTML é¡µé¢ï¼Œå¦‚ /chat/room/123
        v
+--------------------------+
|   Node SSR æ¸²æŸ“æœåŠ¡      | <-- React Router loader/action æ‰§è¡Œã€æ¸²æŸ“ HTML
|   (Vite + Express/Koa)   |
+--------------------------+
        |
        |  fetch /api/chat/room/123 (Java Spring MVC)
        |  WebSocket é•¿è¿æ¥ï¼ˆå¯é€‰ï¼‰
        v
+--------------------------+
|   Java Spring MVC åç«¯   |
|   (WebSocket + API)      |
+--------------------------+

```

---

## âœ… å®æ–½æ­¥éª¤ï¼ˆåˆ†ä¸ºä¸‰å±‚ï¼‰

### 1. Java Spring åç«¯ï¼ˆä¿æŒä¸å˜ï¼‰

- æä¾› REST APIï¼Œæ¯”å¦‚ `/api/users/:id`
- å¤„ç† action æäº¤çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ›´æ–°ã€åˆ›å»ºç­‰

### 2. React Router å‰ç«¯ + SSR å…¥å£

ä½ éœ€è¦ä¸€ä¸ª SSR å…¥å£æ–‡ä»¶ï¼Œå¦‚ `entry-server.tsx`ï¼š

```tsx
import { createStaticHandler, createStaticRouter } from 'react-router-dom/server';
import { routes } from './routes';
import { renderToPipeableStream } from 'react-dom/server';

export async function handleRequest(req, res) {
  const handler = createStaticHandler(routes);
  const context = await handler.query(req.url, {
    request: req,
    signal: req.signal
  });

  const router = createStaticRouter(handler.dataRoutes, context);

  const { pipe } = renderToPipeableStream(
    <RouterProvider router={router} />,
    {
      onShellReady() {
        res.status(200).setHeader("Content-Type", "text/html");
        pipe(res);
      }
    }
  );
}
```

### 3. å¯åŠ¨ SSR æœåŠ¡ï¼ˆExpress/Koaï¼‰

ä½ åªéœ€å¯åŠ¨ä¸€ä¸ªå°çš„ Node æœåŠ¡ï¼Œä½œä¸ºæ¸²æŸ“å™¨ï¼š

```ts
import express from 'express';
import { handleRequest } from './entry-server';

const app = express();

app.use(express.static('dist')); // serve assets

app.get('*', handleRequest);

app.listen(3000, () => {
  console.log('SSR server running at http://localhost:3000');
});
```

---

## âœ… loader ç¤ºä¾‹ï¼ˆä» Java API è·å–æ•°æ®ï¼‰

```ts
// routes/user.tsx
export async function loader({ params }) {
  return fetch(`http://localhost:8080/api/users/${params.userId}`).then(res => res.json());
}

export function UserPage({ loaderData }) {
  return <div>ç”¨æˆ·åï¼š{loaderData.name}</div>;
}
```

---

## âœ… action ç¤ºä¾‹ï¼ˆè¡¨å•æäº¤åˆ° Java APIï¼‰

```ts
export async function action({ request }) {
  const formData = await request.formData();
  const body = new URLSearchParams(formData);
  await fetch("http://localhost:8080/api/users", {
    method: "POST",
    body,
  });
  return redirect("/users");
}
```

---

## âœ… è·¯ç”±é…ç½®ï¼ˆReact Router æ¡†æ¶æ¨¡å¼ï¼‰

```tsx
import { createRoutesFromElements, RouteObject } from "react-router-dom";

export const routes: RouteObject[] = [
  {
    path: "/users/:userId",
    loader,
    action,
    element: <UserPage />,
    errorElement: <ErrorPage />,
  },
];
```

---

## âœ… SSR çš„æ„å»ºæ–¹å¼ï¼ˆæ¨èç”¨ Viteï¼‰

- ä½¿ç”¨ `vite build --ssr` æ„å»º SSR bundle
- å®¢æˆ·ç«¯ç”¨æ­£å¸¸ Vite æ„å»º
- SSR æœåŠ¡ä½¿ç”¨ `vite preview` æˆ– Node å¯åŠ¨
    

---

## âœ… æ€»ç»“

|é—®é¢˜|è§£ç­”|
|---|---|
|ä½ çš„ Java é¡¹ç›®èƒ½å¦ä½¿ç”¨ React Router SSRï¼Ÿ|âœ… å¯ä»¥ï¼Œåªéœ€åŠ ä¸€ä¸ª Node SSR æœåŠ¡|
|Java åç«¯éœ€è¦æ”¹å—ï¼Ÿ|âŒ ä¸éœ€è¦ï¼Œå®ƒä»ç„¶åªæä¾› API|
|React Router loader/action è¯¥å¦‚ä½•å·¥ä½œï¼Ÿ|é€šè¿‡ SSR æœåŠ¡ fetch Java API|
|æ˜¯å¦èƒ½åª SSR éƒ¨åˆ†é¡µé¢ï¼Ÿ|âœ… å¯ä»¥ï¼Œæœªé…ç½® loader çš„é¡µé¢ä»ç„¶æ˜¯ CSR|
|SSR æœåŠ¡æ˜¯å¦å¿…é¡»æ˜¯ Expressï¼Ÿ|âŒ ä¸å¿…é¡»ï¼Œä¹Ÿå¯ä»¥ç”¨ Koaã€Vite Dev Serverã€Cloudflare Workers|

---

## âœ… ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœä½ å¸Œæœ›æˆ‘ï¼š

- å¸®ä½ æ­ä¸€ä¸ª React Router SSR + Java API çš„æœ€å°é¡¹ç›®ç»“æ„
    
- ç»™å‡º SSR æœåŠ¡å’Œå‰ç«¯æ„å»ºæµç¨‹
    
- æä¾›ä¸€ä¸ªâ€œåªæ”¹åŠ¨å‰ç«¯â€çš„è¿ç§»å»ºè®®
    

æˆ‘å¯ä»¥ä¸€æ­¥æ­¥å†™å‡ºæ¥ç»™ä½ ï¼Œè¦ä¸è¦ï¼ŸğŸ‘¨â€ğŸ’»