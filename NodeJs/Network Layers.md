# Networking Layers

---

## 🌐 OSI 七层模型（Open Systems Interconnection Model）

OSI 模型是一个理论参考模型，将网络通信过程分为 **七个层级**，从下到上如下：

| 层级  | 名称（中文） | 名称（英文）             | 作用                           |
| --- | ------ | ------------------ | ---------------------------- |
| 7   | 应用层    | Application Layer  | 面向用户，提供网络服务，如网页浏览、发邮件等。      |
| 6   | 表示层    | Presentation Layer | 数据表示、加密解密、压缩解压。例如把文本转成UTF-8。 |
| 5   | 会话层    | Session Layer      | 管理会话、建立/维持/终止会话，如视频通话的控制。    |
| 4   | 传输层    | Transport Layer    | 端到端传输，确保数据完整，TCP/UDP 就在这一层。  |
| 3   | 网络层    | Network Layer      | IP寻址与路由选择，把数据包送到目标地址。        |
| 2   | 数据链路层  | Data Link Layer    | 物理地址识别（MAC地址）、差错检测，如以太网协议。   |
| 1   | 物理层    | Physical Layer     | 实际传输电信号/光信号，如网线、无线信号。        |

---

## 🎯 举个类比帮助理解：

你要寄一封信：

| 类比          | 网络层级  | 解释                  |
| ----------- | ----- | ------------------- |
| 信的内容        | 应用层   | 你想传达的信息（网页内容、邮件正文等） |
| 语言翻译、加密     | 表示层   | 把内容转成网络可识别格式        |
| 对话管理        | 会话层   | 保持对话不中断             |
| 把信分段编号      | 传输层   | 拆分成小包裹，添加序号         |
| 确定收件人地址     | 网络层   | 根据 IP 地址确定目的地       |
| 写上收件人姓名/门牌号 | 数据链路层 | 使用 MAC 地址在局域网中投递    |
| 实际派送过程      | 物理层   | 电缆或无线信号真正传输数据       |

---

## ✅ 总结（图表版）


OSI 七层模型            TCP/IP 四层模型           主要协议/功能
---------------------- ---------------------- -----------------------------
7. 应用层               4. 应用层                HTTP, FTP, DNS, SMTP, POP3
8. 表示层               ↘                        加密、解密、压缩、格式转换
9. 会话层               ↘                        建立/管理/断开会话连接
---------------------- ----------------------
4. 传输层               3. 传输层                TCP, UDP, 端口号、数据分段
---------------------- ----------------------
3. 网络层               2. 网络层                IP, ICMP, 路由、IP地址
---------------------- ----------------------
2. 数据链路层           1. 网络接口层            MAC地址，ARP，以太网
3. 物理层               ↘                        电信号、光信号、Wi-Fi


---

## 物理层

- cables
- 信息通过bit传递
- 只关注0/1，以及如何移动他们，不考虑任何地址相关的想法


# 简化的层级

![[Pasted image 20250514233056.png]]

## 数据链路层

- 交换机在这一层工作
- 移动data和frame
- 接收0/1将其转换整合为frame，提取MAC地址（包括source和destination,将其称为frame）
- 寻找哪台机器有这个目标MAC,发送Frame
- 机器的网卡会接收这些0/1，在将其再次转换为一个Frame

## 网络层

- 其中整合的数据为Packets
- IP寻址与路由选择，把数据包送到目标地址
- 路由器知道应该选择哪个路由器，那个路由器也会继续知道他需要定位到那个路由器

## Transport Layer

- 数据称为Segment
- 是一个确认层
- 会有一些端口，将数据送到正确的application
- 防止数据丢失，当packets丢失时，resend信息（包括目的地和来源等等）

## Application Layer

- 数据就称之为data
- 这是nodeJs关注的层级

# 对于Node后端

了解应用层
了解协议选择
了解IP地址

that's enough

# TCP和UDP

- TCP保证所有数据完整不变的被发送
- UDP用于保证传输的速度，在传输视频图像声音等等信息时，我们通常不在意小部分的数据丢失
- NodeJs中有两个模块对应这两个部分，Net模块对应着TCP应用，datagram对应UDP


白色部分是TCP headers，和蓝色部分数据一起组成一个segement

![[Pasted image 20250515144646.png]]

| 步骤  | 机制名称                            | 保证内容   | 说明                       |
| --- | ------------------------------- | ------ | ------------------------ |
| 1️⃣ | **序列号（Sequence Number）**        | 顺序编号   | 每个 TCP 报文带编号，确保数据“顺序可识别” |
| 2️⃣ | **确认号（Acknowledgement Number）** | 收到反馈   | 接收方告诉发送方“我收到哪一部分了”       |
| 3️⃣ | **超时重传（Retransmission）**        | 补发丢包   | 若 ACK 超时未到，自动重发丢失的那段数据   |
| 4️⃣ | **校验和（Checksum）**               | 检测错误   | 检查内容有没有在传输中损坏（位反转、损坏等）   |
| 5️⃣ | **重排序（Reordering）**             | 顺序恢复   | 数据乱序到达时，先缓存，再按序交给应用层     |
| 6️⃣ | **流量控制（Flow Control）**          | 接收能力保护 | 接收方告诉发送方“我还能接多少”，用窗口控制   |
| 7️⃣ | **拥塞控制（Congestion Control）**    | 网络保护   | 检测网络是否拥塞，动态控制发送速率        |

UDPsegement结构

![[Pasted image 20250515145930.png]]


UDP没有TCP那么严格，他可以仅仅发送数据，不关心是否有接受方，不关心数据是否会丢失等等

checksum仅仅用于检查数据是否被裁剪