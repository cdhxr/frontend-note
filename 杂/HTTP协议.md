

- 浏览器过程
	- ![[浏览器过程.png]]
# **HTTP（超文本传输协议）简介**

**HTTP**（HyperText Transfer Protocol）是用于在客户端（如浏览器）和服务器之间传输数据的协议。它是万维网的核心协议，用于定义数据通信的规则和格式。

---

### **HTTP 的关键特点**

1. **基于请求-响应模式**  
    客户端发送请求（request），服务器返回响应（response）。
    
    - **请求**：客户端向服务器发送信息，例如获取网页内容或提交表单。
    - **响应**：服务器返回请求的结果，例如 HTML 页面、JSON 数据、图片等。
2. **无状态协议**
    
    - 每次请求都是独立的，服务器不会记住之前的请求状态。
    - 可以通过 **Cookies** 或 **Session** 实现状态跟踪。
3. **灵活的数据传输**  
    HTTP 支持多种数据类型（HTML、JSON、XML、图片、视频等），通过 MIME 类型标识。
    
4. **简单明了**  
    HTTP 使用人类易读的文本格式进行通信，便于调试和分析。
    

---

### **HTTP 的工作流程**

1. 客户端输入 URL（例如 `http://example.com`）。
2. 通过 DNS 解析获取服务器 IP 地址。
3. 客户端发送 HTTP 请求到服务器。
4. 服务器处理请求并返回响应。
5. 客户端根据响应呈现内容。



# HTTP报文

**HTTP报文**是指在客户端和服务器之间通过HTTP协议传递的数据格式，分为
**请求报文**和**响应报文**。

---

### **1. HTTP报文的本质**

HTTP报文是基于**文本**的通信内容，通常由以下部分组成：

- **起始行**：定义了请求的基本信息或响应的状态。
- **头部信息（Headers）**：提供了附加的元数据，比如请求的描述、数据格式、缓存规则等。
- 空行
- **主体部分（Body）**：可选，用于传输实际数据，如HTML、JSON等内容。


![[http报文.png]]

### **2. 请求报文（HTTP Request Message）**

请求报文由**客户端**发送到**服务器**，用于请求资源或服务。

#### **组成：**

1. **请求行（Request Line）**
    
    - 包括：
        - HTTP方法（如 `GET`, `POST`, `PUT`, `DELETE` 等）
        - 请求目标（如 `/index.html` 或 `/api/data`）
        - HTTP版本（如 `HTTP/1.1`）
2. **请求头（Headers）**
    
    - 描述请求的元信息，如客户端类型、支持的格式、主机地址等。
    - 示例：
        
        `Host: www.example.com User-Agent: Mozilla/5.0 Accept: text/html`
        
3. **空行**
    
    - 用于分隔请求头和请求体。
4. **请求体（Body）**（可选）
    
    - 包含请求中要发送的数据（如表单信息、文件、JSON数据等）。
    - 仅在某些方法（如 `POST` 或 `PUT`）中使用。

---

### **3. 响应报文（HTTP Response Message）**

响应报文由**服务器**发送到**客户端**，用于返回请求的结果。

#### **组成：**

1. **状态行（Status Line）**
    
    - 包括：
        - HTTP版本（如 `HTTP/1.1`）
        - 状态码（如 `200` 表示成功，`404` 表示资源未找到）
        - 原因短语（如 `OK`, `Not Found`）
2. **响应头（Headers）**
    
    - 描述响应的元信息，如内容类型、数据长度、缓存控制等。
    - 示例：
        
        `Content-Type: text/html; charset=UTF-8 Content-Length: 138`
        
3. **空行**
    
    - 用于分隔响应头和响应体。
4. **响应体（Body）**（可选）
    
    - 包含服务器返回的实际内容，如HTML页面、JSON数据或文件。

# start line

## Method

在请求报文中的startline

| Method  | Description                       |
| ------- | --------------------------------- |
| GET     | 请求一个指定资源的表示形式。使用GET的请求应该只被用于获取数据。 |
| POST    | 用于将实体提交到指定的资源，通常导致在服务器上的状态变化或副作用。 |
| PUT     | 用请求有效载荷替换目标资源的所有当前表示。             |
| DELETE  | 删除指定的资源。                          |
| HEAD    | 请求一个与GET请求的响应相同的响应，但没有响应体。        |
| CONNECT | 建立一个到由目标资源标识的服务器的隧道。              |
| OPTIONS | 用于描述目标资源的通信选项。                    |
| TRACE   | 沿着到目标资源的路径执行一个消息环回测试。             |
| PATCH   | 用于对资源应用部分修改。                      |

安全的方法/不安全的方法：是否修改服务器端数据

幂等的方法：执行多次相同的方法效果一致

## **状态码**

在响应报文中的startline

1xx - 指示信息，表示请求已接收，继续处理

2xx - 成功，表示请求已被成功接收、理解、接受

3xx - 重定向，要完成请求必须进行更进一步的操作

4xx - 客户端错误，请求有语法错误或请求无法实现

5xx - 服务器端错误，服务器未能实现合法的请求

- 200 OK - 客户端请求成功
- 301 - 资源（网页等）被永久转移到其它 URL
- 302 - 临时跳转
- 401 Unauthorized - 请求未经授权
- 404 - 请求资源不存在，可能是输入了错误的 URL
- 500 - 服务器内部发生了不可预期的错误
- 504 Gateway Timeout - 网关或者代理的服务器无法在规定的时间内获得想要的响应。

以下是图片中的内容：

## **常用请求头**

| 请求头               | 描述                                             |
| ----------------- | ---------------------------------------------- |
| Accept            | 接收类型，表示浏览器支持的MIME类型（对标服务端返回的Content-Type）      |
| Content-Type      | 客户端发送出去实体内容的类型                                 |
| Cache-Control     | 指定请求和响应遵循的缓存机制，如no-cache                       |
| If-Modified-Since | 对应服务端的Last-Modified，用来匹配看文件是否变动，只能精确到1s之内      |
| Expires           | 缓存控制，在这个时间内不会请求，直接使用缓存，服务端时间                   |
| Max-age           | 代表资源在本地缓存多少秒，有效时间内不会请求，而是使用缓存                  |
| If-None-Match     | 对应服务端的ETag，用来匹配文件内容是否改变（非常精确）                  |
| Cookie            | 有cookie并且同域访问时会自动带上                            |
| Referer           | 该页面的来源URL（适用于所有类型的请求，会精确到详细页面地址，csrf拦截常用到这个字段） |
| Origin            | 最初的请求是从哪里发起的（只会精确到端口），Origin比Referer更尊重隐私      |
| User-Agent        | 用户客户端的一些必要信息，如UA头部等                            |

## 常用响应头

| 常用响应头                       | 描述                                      |
| --------------------------- | --------------------------------------- |
| Content-Type                | 表示浏览器返回的实体内容的类型                         |
| Cache-Control               | 指定请求和响应遵循的缓存机制，如 no-cache               |
| Last-Modified               | 如果文档已经过期，则设置为文档最后修改的日期/时间               |
| ETag                        | 资源的特定版本的标识符，Etags 类似于指纹                 |
| Set-Cookie                  | 设置和页面关联的 cookie，服务器通过这个头部把 cookie 传给客户端 |
| Server                      | 服务器的一些相关信息                              |
| Access-Control-Allow-Origin | 服务器端允许的请求 Origin 头部 (譬如为 *)             |
|                             |                                         |

## 缓存（请求头场景）

**强缓存**是指浏览器根据缓存策略直接从本地缓存中读取数据，无需与服务器进行任何通信；

**协商缓存**是在缓存过期后，浏览器会向服务器发送请求验证资源是否有更新，若未更新则使用本地缓存，否则下载新资源。

![[缓存请求过程.png]]

### 强缓存
#### Expires
- 过期时间
#### Cache-Control
- 可缓存性
	- no-cache: 协商缓存验证
	- no-store: 不使用任何缓存
- 到期
	- max-age: 单位是秒，存储的最大周期
- 重新验证`*`重新加载
	- must-revalidate: 一旦资源过期，在成功向原始服务器验证之前，不能使用
### 协商缓存
#### Etag/If-None-Match
- 资源的特定版本的标识符，类似于指纹

#### Last-Modified/If-Modified-Since
- 最后修改时间

## cookie
### HTTP中的Cookie是什么？

Cookie是存储在用户浏览器中的小块数据，由服务器通过HTTP协议设置，帮助服务器在客户端与服务端之间保持状态。例如，当用户登录某个网站时，Cookie可用于保存登录信息，以便在用户再次访问时，网站识别用户身份。

**Set-Cookie - response**

|参数|说明|
|---|---|
|**Name=value**|各种cookie的名称和值|
|**Expires=Date**|Cookie的有效期，缺省时Cookie仅在浏览器关闭之前有效。|
|**Path=Path**|限制指定Cookie的发送范围的文件目录，默认为当前|
|**Domain=domain**|限制cookie生效的域名，默认为创建cookie的服务器域名|
|**secure**|仅在HTTPS安全连接时，才可以发送Cookie|
|**HttpOnly**|JavaScript脚本无法获得Cookie|
|**SameSite= [None\|Strict\|Lax]**|- None: 同站、跨站请求都可发送- Strict: 仅在同站发送- Lax: 允许与顶级导航一起发送，并将与第三方网站发起的GET请求一起发送|

